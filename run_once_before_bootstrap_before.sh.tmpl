#!/bin/bash

set -Eeuo pipefail

red=$(tput setaf 1)
green=$(tput setaf 2)
reset=$(tput sgr0)

echo "${green}Installing requirements${reset}"
{{ if eq .chezmoi.osRelease.id "ubuntu" "debian" }}
    echo "${green}  Debian/Ubuntu detected...${reset}"
    sudo apt-get update &&
        sudo apt-get -y install git git-crypt lsb-release curl zsh \
            tomb python3-pip gnupg2 pcscd scdaemon pcsc-tools \
            yubikey-manager
{{ else if eq .chezmoi.osRelease.id "arch" "manjaro" }}
    echo "${green}  Arch Linux detected...${reset}"
    pamac install --upgrade --no-confirm git curl zsh run-parts unzip \
        neovim fzf yubico-pam yubikey-manager yubikey-touch-detector \
        jq github-cli git-delta bat nextcloud-client \
        nextcloud-client-cloudproviders myrepos base-devel khal \
        vdirsyncer python-requests-oauthlib papirus-icon-theme
    {{ if not (lookPath "kwalletcli") }}
    pamac build --no-keep --no-confirm kwalletcli
    {{ end }}
    {{ if not (lookPath "hardcode-tray") }}
    pamac build --no-keep --no-confirm hardcode-tray-git 
    {{ end }}
{{ end }}

sh -c 'curl -fLo "${XDG_DATA_HOME:-$HOME/.local/share}"/nvim/site/autoload/plug.vim --create-dirs \
       https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim'

# vim: set ft=sh:
